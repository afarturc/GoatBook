{% extends "layout.html" %}

{% block content %}
<div class="lg:flex justify-center lg:space-x-10 lg:space-y-0 space-y-5">
  <div class="space-y-5 flex-shrink-0 lg:w-7/12">
    {% for post in posts %}
      <a href="/post/{{ post.id }}">
        <div class="card w-1/2 bg-base-100 shadow-2xl mx-auto mb-4">
          <img src={{ post.image.url }} />
          <div class="card-body">
            <h2 class="card-title">{{post.caption}}</h2>
            <small>{{ post.date }}</small>
            <small>Coment√°rios: {{ post.comment_count }}</small>
            <small>likes: <span id="like_count">{{ post.like_count }}</span></small>
            <div class="card-actions justify-end">
              <button class="btn btn-outline btn-error" value="{{post.id}}" id="like_button">
                <i class="fa-regular fa-heart fa-lg" />
              </button>
            </div>
          </div>
        </div>
      </a>
    {% endfor %}
    {% if friend %}
      <div class="lg:w-5/12">
        <div class="bg-white  shadow-md rounded-md overflow-hidden">
          <div class="bg-gray-50  border-b border-gray-100 flex items-baseline justify-between py-4 px-6 ">
            <h2 class="font-semibold text-lg">Users You Can Follow</h2>
            <a href="#"> Refresh</a>
          </div>
          {% for x in new_users %}
            <div class="divide-gray-300 divide-gray-50 divide-opacity-50 divide-y px-4 ">
              <div class="flex items-center justify-between py-3">
                <div class="flex flex-1 items-center space-x-4">
                  <a href="profile.html">
                      <img src= {{ x.profile_pic.url }} class="bg-gray-200 rounded-full w-10 h-10">
                  </a>
                  <div class="flex flex-col">
                    <span class="block capitalize font-semibold"> tomi_ml </span>
                    <span class="block capitalize text-sm"> 320k followers </span>
                  </div>
                </div>
                <button class="btn btn-primary">Follow</button>
              </div> 
            </div> 
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </div>
</div>
<script>
  $(document).on('click', '#like_button', function(e) {
    e.preventDefault();
    var post_id = $(this).val();
    $.ajax({
      url: '{% url "like_post" %}',
      type: 'POST',
      data: {
        'user_id': {{ user.id }},
        'post_id': post_id,
        'csrfmiddlewaretoken': '{{ csrf_token }}',
        'action': 'post'
      },
      success: function(json) {
        if (json['type'] == 'like'){
          document.getElementById("like_count").innerHTML = json['result'];
          document.getElementById("like_button").innerHTML = '<i class="fa-solid fa-heart fa-lg"></i>';
        } else {
          document.getElementById("like_count").innerHTML = json['result'];
          document.getElementById("like_button").innerHTML = '<i class="fa-regular fa-heart fa-lg"></i>';
        }
        console.log(json)
      }
    });
  });
</script>
{% endblock %}
